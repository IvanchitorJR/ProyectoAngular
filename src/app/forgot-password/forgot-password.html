<div class="auth-container">
  <!-- Paso 1: Solicitar código de verificación -->
  <div *ngIf="step === 'request'">
    <h2>Recuperar Contraseña</h2>
    <p class="text-muted">Ingresa tu correo para recibir un código</p>
    
    <form (ngSubmit)="requestToken()" #requestForm="ngForm">
      <div class="form-row">
        <label>Correo *</label>
        <input 
          type="email" 
          [(ngModel)]="email" 
          name="email"
          placeholder="correo@ejemplo.com"
          required 
          email
          #emailInput="ngModel"
        />
        <span *ngIf="emailInput.invalid && emailInput.touched" class="error-text">Correo válido requerido</span>
      </div>
      
      <button type="submit" [disabled]="requestForm.invalid || isLoading">
        {{ isLoading ? 'Enviando...' : 'Enviar Código' }}
      </button>
      <a routerLink="/login" class="link">Volver a login</a>
    </form>
    
    <div *ngIf="message" class="alert" [class.alert-error]="messageType === 'error'" [class.alert-success]="messageType === 'success'">
      {{ message }}
    </div>
  </div>

  <!-- Paso 2: Verificar código y cambiar contraseña -->
  <div *ngIf="step === 'reset'">
    <h2>Cambiar Contraseña</h2>
    <p class="text-muted">Código enviado a {{ email }}</p>
    
    <form (ngSubmit)="resetPassword()" #resetForm="ngForm">
      <div class="form-row">
        <label>Código (6 dígitos) *</label>
        <input 
          type="text" 
          [(ngModel)]="token" 
          name="token"
          placeholder="000000"
          maxlength="6"
          required
          pattern="[0-9]{6}"
          #tokenInput="ngModel"
        />
        <span *ngIf="tokenInput.invalid && tokenInput.touched" class="error-text">Código de 6 dígitos requerido</span>
      </div>
      
      <div class="form-row">
        <label>Nueva Contraseña *</label>
        <input 
          type="password" 
          [(ngModel)]="newPassword" 
          name="newPassword"
          placeholder="Mín. 6 caracteres"
          required
          minlength="6"
          #passwordInput="ngModel"
        />
        <span *ngIf="passwordInput.invalid && passwordInput.touched" class="error-text">Mín. 6 caracteres</span>
      </div>
      
      <div class="form-row">
        <label>Confirmar Contraseña *</label>
        <input 
          type="password" 
          [(ngModel)]="confirmPassword" 
          name="confirmPassword"
          placeholder="Repite la contraseña"
          required
          #confirmInput="ngModel"
        />
        <span *ngIf="newPassword !== confirmPassword && confirmPassword" class="error-text">Las contraseñas no coinciden</span>
      </div>
      
      <button type="submit" [disabled]="resetForm.invalid || newPassword !== confirmPassword || isLoading">
        {{ isLoading ? 'Cambiando...' : 'Cambiar Contraseña' }}
      </button>
      
      <button type="button" class="link-btn" (click)="goBackToRequest()" [disabled]="isLoading">
        ← Usar otro correo
      </button>
      
      <p class="text-muted mt-1">¿No recibiste código?
        <button type="button" class="link-btn" (click)="resendCode()" [disabled]="resendCooldown > 0">
          {{ resendCooldown > 0 ? 'Espera ' + resendCooldown + 's' : 'Reenviar' }}
        </button>
      </p>
    </form>
    
    <div *ngIf="message" class="alert" [class.alert-error]="messageType === 'error'" [class.alert-success]="messageType === 'success'">
      {{ message }}
    </div>
  </div>

  <!-- Paso 3: Confirmación exitosa -->
  <div *ngIf="step === 'done'" class="success-message">
    <h2>✓ ¡Éxito!</h2>
    <p>Tu contraseña ha sido actualizada</p>
    <button routerLink="/login">Ir a Login</button>
  </div>
</div>
