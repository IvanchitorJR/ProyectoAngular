<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h3 class="card-title mb-0">
            <i class="mdi mdi-package-variant me-2"></i>
            Gestión de Inventario
          </h3>
          <button class="btn btn-outline-light btn-sm" (click)="logout()">Cerrar Sesión</button>
        </div>

        <div class="card-body">
          <!-- Formulario para agregar producto -->
          <div class="mb-4">
            <h5 class="mb-3">Agregar Nuevo Producto</h5>
            <form (submit)="$event.preventDefault(); addProducto()" class="row g-2">
              <div class="col-md-3">
                <label class="form-label">Nombre *</label>
                <input class="form-control" [(ngModel)]="nuevo.nombre" name="nombre" required placeholder="Nombre del producto" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Precio *</label>
                <input type="number" step="0.01" class="form-control" [(ngModel)]="nuevo.precio" name="precio" required placeholder="0.00" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Cantidad</label>
                <input type="number" class="form-control" [(ngModel)]="nuevo.cantidad" name="cantidad" placeholder="0" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Imagen (URL)</label>
                <input class="form-control" [(ngModel)]="nuevo.imagen" name="imagen" placeholder="https://..." />
              </div>
              <div class="col-md-12">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" [(ngModel)]="nuevo.descripcion" name="descripcion" rows="2" placeholder="Descripción del producto"></textarea>
              </div>
              <div class="col-md-12">
                <button class="btn btn-success" type="submit">
                  <i class="mdi mdi-plus me-1"></i>
                  Agregar Producto
                </button>
              </div>
            </form>
          </div>

          <hr />

          <!-- Tabla de productos -->
          <h5 class="mb-3">Productos en Inventario</h5>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Precio</th>
                  <th>Cantidad</th>
                  <th>Descripción</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of productos">
                  <td><strong>{{ p.id }}</strong></td>
                  <td>{{ p.nombre }}</td>
                  <td>{{ p.precio | currency }}</td>
                  <td *ngIf="editingId !== p.id" class="text-center">
                    <div class="qty-controls">
                      <button class="btn btn-sm btn-outline-secondary me-1" (click)="decrementar(p)" title="Quitar 1">-</button>
                      <span class="qty-value">{{ p.cantidad ?? 0 }}</span>
                      <button class="btn btn-sm btn-outline-secondary ms-1" (click)="incrementar(p)" title="Agregar 1">+</button>
                    </div>
                  </td>
                  <td *ngIf="editingId === p.id" class="text-center">
                    <input type="number" class="form-control form-control-sm" [(ngModel)]="p.cantidad" />
                  </td>
                  <td>
                    <span *ngIf="editingId !== p.id">{{ p.descripcion || '—' }}</span>
                    <textarea *ngIf="editingId === p.id" class="form-control form-control-sm" rows="2" [(ngModel)]="p.descripcion"></textarea>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-primary me-1" *ngIf="editingId !== p.id" (click)="startEdit(p)">
                      <i class="mdi mdi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-success me-1" *ngIf="editingId === p.id" (click)="saveEdit(p)">
                      <i class="mdi mdi-content-save"></i>
                    </button>
                    <button class="btn btn-sm btn-secondary me-1" *ngIf="editingId === p.id" (click)="cancelarEdit()">
                      <i class="mdi mdi-close"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" (click)="eliminar(p.id)">
                      <i class="mdi mdi-delete"></i>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="productos.length === 0">
                  <td colspan="6" class="text-center text-muted py-3">No hay productos en el inventario</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>